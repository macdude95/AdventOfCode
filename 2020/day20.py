import itertools
import numpy

tileDict = {"2477":["....#...#.","#..##...#.","...#.....#","..#...#.#.","#.#......#",".#.#######","..#.#...#.",".#.....#..","#..#......",".###.####."],"2609":[".##...####","...#.##.##","...#......","...#....#.",".##....#.#","..........","....##....","#....#..##","..######..",".##.##.#.#"],"3461":["##.##..##.",".##....#..","...#....#.","#.#.#...#.","........#.",".#.#..#..#","..#.......","#..##.....","...#.....#",".#..####.."],"1753":["#...#####.","#...#.#..#","#.#....#..","#.......#.",".....###.#",".......#..",".....#....","..##...#.#","#......#..","#.#..##.#."],"1259":["...##...##","#.##.#.###","#.#.....#.","###..#...#","...#......","##.#..#...","#........#","..##.####.","..##....##","....##.#.."],"3181":[".#######.#","#...#....#","#.....#..#","#.#.#...#.",".#..#.....","....#.....","#.......#.","#.........","..#..###..",".##..#...#"],"1123":["#..####.#.","#...#.....","#.........","....#.#..#","..........","..##...#.#","#..#......","#...#.#..#",".##.##....","#####.####"],"2699":["....###.#.","#.#......#","#..##....#","..#.....#.","#.#......#","....#...##",".##...#.##","..........","#.#...#...","##.#...#.#"],"2897":["#.#.##..##","#....#..##","....#...#.","..........","#..#..#..#","#.........","##.......#","##.##....#","........##","#.##.#...#"],"2531":[".##....#.#","#...#..###","...#....#.","#.......##","#.......##","......#...","#.#.......","#......#.#","#..#.#...#","...#.##..#"],"3917":[".#.#.#..#.","##..#....#","....#....#","#.##..#..#","#...#....#",".....#.#.#",".....#.#.#","##..#.#.##",".....#...#",".##.###.##"],"1193":["#.###...##","#..##.####","#.#......#","...###....",".#.#..#...","##...#...#","##.......#","..........","...#......","##..#.#.#."],"2011":["####.#..#.","..#...#..#","#.....#...","..........","..#.#.....","#........#",".....#...#","#........#",".........#",".###..##.."],"3209":["######.##.","......#..#","....#...##","..##..#...","...#.....#","....##...#","#.......##","..#..#....","....#.....",".#..#.####"],"3659":[".#...##..#","........#.","#...#.....","#........#","....##...#","#..#....#.",".#..#..#..","#....#.#.#",".........#","###.#.#..#"],"3623":[".##..##...","..#.....##","#.........",".#.#.....#","...#.....#",".......##.","#.......#.","...#.#...#","#......#.#","..#####..."],"3049":["####.#####","..#.....#.",".#..#...#.",".#..##...#","#........#","#.#.......","#.##......",".#....#..#","##........",".####..#.#"],"3361":["....#.#..#","...#...###","#....#...#","#....##..#","###.#.##.#","...#.#...#","##.#......","#....##..#",".#.....###",".##.#....."],"2861":[".#.##.#..#","#..#...#..","....#....#","..#.....##","...#.....#","#..##.....","##.......#",".....#...#",".#..#..#..","..#.#.#.#."],"3797":[".......##.","#....#....","#..#...#..","#..#..###.","#.#...#..#",".#...#...#","...##.....",".#.....#..","..#.....#.","#.##.##..#"],"3593":[".#.....###","..##....#.","..##..#...","#...#...##",".#.....#.#","#.#...#..#","#....#...#","#.....#..#","###..#.###",".##..##.#."],"2161":[".#.##....#","#....#....","....#....#","####...##.","#..#..##.#","#.........","..#.#...##","#.....#..#",".........#","#.###.#..."],"3769":["#..###....","##........","#.#....#..","....#.....","#..##.#...","#....#.#..","#........#","......#.#.","##.....#.#",".#....#..#"],"3467":["..#.#.####","##.......#",".##..#....","...###...#",".##.###..#","....###..#",".....#....","##.......#","#....##...","#.#..#..#."],"2503":["#..###.###",".#.....#.#","#......#.#","...#.##...","###.#....#","....#....#","#.#...##..","#.......#.","#.#.#....#","....######"],"3389":["#..###..##","..........",".......##.","..........","..........","..........","#.....###.",".........#","##.#.##..#",".##.##.#.."],"3919":["..#..#.#..","##....##.#","##..#...#.","#.......##","#.#.#.#...","##..#.#..#","......##.#","...###...#","#...#.....","..#.#.#..."],"2663":["#.#...####",".......#.#",".#.....#..","#.....#.##",".#..#.....","..##..#..#","#......##.","...#...#..","#.##...#.#","...##....."],"3253":[".#####..#.",".......#.#","#..#...##.","....#.....",".........#","...#.#....","##........","........#.","#....#...#",".####.##.#"],"3329":["......####",".......#.#","..##......","#....#...#",".....##...",".....#..##",".....#....",".#.#.#....",".#.......#","#.##......"],"2393":[".#...#...#","....#.....","....#...##","#.#..##.#.","...#.#...#",".....#..#.",".##..##..#","##..#..#..",".#........",".##.#.#.#."],"2339":["##....##.#","..#......#","##.....##.",".........#","...##....#","#....#.##.","#.#.....##",".#..#.##..","##.###..#.","######..#."],"1097":["###.##.#.#",".#.#.....#","...#.#....","##...##...",".#....##..","#....##.##","....##....","#.#......#","#.#..#...#","#.####...."],"2423":["#....#.#..","#.....#...","#.........","#...#.....","..###.#..#","#...##....","#.........","#..#.....#","...#..#...","#..##.#..."],"3067":[".#####.#.#","###..#.#..","..........","#........#","..##.....#","#......#..",".#..#.#...","##...#..##","....#.....","...#.##.##"],"3541":["#.#.##.###","..........","..#.#...##","#..##.#..#",".........#","#.....#...","#..#......","#.##......",".#...#.#.#",".#####..##"],"3559":["##.#.#.#..","#....#..#.","##...#....",".....#..##","#.........","..#...#...",".#...#...#","#...#..#..","....#....#",".....###.#"],"2797":[".....#..##","#.#....#..","##...#....","#.........","...#......","...#...#..","#.......#.","..........","....#....#","#......###"],"2803":["##....#.##","..#.......",".###.#....","#.#.#.....",".........#","#..#...##.","#.#.##..#.",".##...##.#","#.#......#",".###.#.#.."],"2297":[".#.#.##.#.","#.##.....#","#.##....#.",".......#.#","#..#......",".##.#..#..","..........","..#.##..##","#.......##",".###.##.#."],"3511":["...#.#....","#.....#..#",".......#..","..##.#.##.","#.#....#..","#.#.#.#...",".#........","#.#.....##",".#....#..#","####..#.#."],"2083":["#####.....","##..#.#..#","....#....#","...#......","##....##.#","#....#.#..","##.....##.",".......#.#","##........","###..##.##"],"1567":["####.###.#","....#....#",".#..##.#..","#........#","...#.#...#","#.#..##.##","##...#....","##........","#........#","#...#.#..#"],"2767":["..###.##..","#..#..#..#",".###.....#","#..#......","......####","....#..#..","#.....##.#","#.#...#..#",".#....##..",".#..####.."],"2081":[".#.##.####","#...#.#...","#...#.##..","..#.....##","...##....#","...#......","...#.#....","..........","..........",".####..###"],"1697":["...#...###","#..#..#...",".....#..#.","#........#","#..#......","#.......#.","#....#....","#...#.##..","#....#..##","#.##..#..."],"3433":[".###...##.","#........#",".#...###.#","##.......#",".......#.#",".....##.#.","#..#..#...",".......#..",".....###..",".....#.#.#"],"1543":["#.###.##..",".#...#....","##.....###","#..####.#.","#...#.....",".#......##","#.........","....#.#.##","##.......#",".#........"],"2389":["#....#####",".##......#","###.#....#","..#.......","...#.#...#",".......#.#","#....#....","...#...#..","#.#.......",".##..###.#"],"2347":["#....##..#","#......###","........#.",".#...#.#..","#........#",".....##...","#........#","#.....#...","##....#..#","##...#.###"],"1877":[".#.#.##.#.","#..##...##","#...#...##","##.#......","........##","....#.#..#","#..##.....","....#...##","#.#.#.#..#",".#..#..#.#"],"2927":[".#.#...###","#...#.....","..#.......","##...#...#","#..#...#.#","..........","#.#..##...","#.#.......",".....#...#","......###."],"1483":["..#.#...#.","###.##....","#..##.....",".#...##..#","...#.##.##","#.#..#.#.#","..#..#....","#..#......","#........#","....##.##."],"1493":["#.#....##.","..#....#..","..........",".....#...#",".....##..#","...#..#..#",".........#","#.#.#....#",".#.....#.#","..###...#."],"2621":["#..##.#..#","..##.#...#","..........","#......#..",".###..#...","###.#....#","##..#....#","##..#....#",".........#","##.#......"],"3167":["..#.###..#","###.#....#","#........#","..##......","###.#..#..","##...#...#","..........","##.#...#.#",".###.....#","####.##..."],"3701":[".#.#...##.","......#...","#.........","......#..#","....#....#","....#.#..#","#..##....#","#.....#..#","#...###..#","..##.#...."],"1663":["##.#..##..","#.....#...","....###...","#....##..#","....#...#.","#..####..#","...##.....",".##..#....","#.#....#..","#..##.#.##"],"1879":[".#....#...","....###.#.","#....#...#","#..##.....","#......#.#",".....#....","#.........",".........#",".#........","##.#...#.#"],"1021":["..#.......",".#......##",".##...#...",".##.......","##.#...#.#","#..#.....#",".#........","...###...#","###.......","....#..###"],"3767":["..#.#....#",".....#.#..","..#..#....","##..##....",".#.......#","...#......","......##.#","#.......##","#........#",".######.##"],"1847":["....####.#","##.#...#..","##.#.##..#","..####...#","#........#","#.........","#...#....#","##.#.#..##","..##.....#","##.##..#.."],"3691":["#.##..#...","...#....#.","#...#.....",".....#....","......#.#.",".#........",".#........",".........#","..........","#.....##.#"],"2351":["###..###.#","#....##...","#......#..","###......#","#...##.###","##...##..#","..#.......",".#....##..","...#......",".###.##.##"],"2753":["#.####..#.","#.......#.","..#.#.....",".....#....","#..#..#...","#......#..","..#...####","#.......##","....#...#.","....#.#..#"],"2141":["....##...#","..#..#....","..........","..........","###....#..","...##.#...","##.#.....#",".#....#..#","#.#....#..",".#########"],"1901":[".....#.#.#","#......#..","#...#...#.","...#....##","#..#.#....","........#.",".......#.#","#.....##..","#...#.#.##",".#....##.#"],"3137":[".##...#...",".#.....###","#.#.#..#.#","#.###.#...","#..##...#.",".........#","#.#..###.#","#......#.#","#......#..",".#..#.#..."],"3407":[".#.###.###","...#......","..#.##....",".#.....#..","....#.#..#","...#...#..","....#..#..","##...#....",".#....###.","##.###.##."],"1013":["##.#.###..","#...#.##.#","#........#","#..#.....#","..........",".........#","...#......",".#.....#.#",".......#..",".#...####."],"1049":["...#....##","#.........","#.....#..#","#..#....##",".##...#...","......#..#","##..#.#...","#.##....##","....#....#","#####.#.#."],"2549":["#.#..###.#","#..#......","...#....#.",".....#...#","#.##.....#","###..#.#..","...##.....","##...#....","#......#..","..##.####."],"2843":[".##.###...","....#....#","#.......##","#........#",".......#.#","#.......##","#.#..#...#","#...#.....","#...#....#",".....###.."],"1889":["##.##..#..","...#....##","#........#","#......#..","##..#.#.##","......#...","..#.......","..#......#","#.#..#....","..#......#"],"2887":[".####.##.#","#..#......","#.........","#....#....","#....#...#",".....#...#","#.#.#.##.#",".#........","##.#.#....","...#.#.##."],"1579":["..######.#","..........","#.##..#...","####..#..#","#........#","...##....#","..#.......","..........","..........","....#....#"],"3079":["##.#....#.","###.....##","...##...##","#....#..#.","....###...","...####...","...#.#....",".#.#.#..##",".....#..#.","##...#..#."],"1297":[".####.###.","##...#...#",".....#..#.","#...#.....","###......#",".#..#....#","#....#..##",".##...#...","#....#....","###.####.#"],"1783":["...#.#.#..","#...#.....","..#..#...#","......##..","###..#.##.",".#...###..","#.........","#........#","..#......#","..#..##.#."],"1609":[".#.##..#.#",".#.#....#.","#.##......","..#......#",".##.#.#.##","..#.......","###......#","...#...#.#","...###....","..#.....#."],"3793":["##.#.##.#.","...#......","..##....#.","#...#...##",".......#.#",".....#.#..","....#....#","#.##.....#","#..#.##..#","###.##..#."],"1069":["..#.#...#.","..#.#....#","##..#.#..#",".....#....",".....##.#.",".#.##.#...","#.......##","##........","....#.#..#",".#..###.##"],"1229":["..#.#####.",".......#..","....#.#.##",".#........","#...#..##.","##....#.#.","#........#","..........",".......#..","##.##....#"],"1163":["....#.#.#.","#..#.#...#",".........#","#........#","#....#....","..#.#....#","#...#....#","#....##...","#..#......","#..##.#.##"],"3847":["#...#.####",".........#","......#...","#..#..#.##",".....##...","#........#","#...#....#","#.#....#.#","#...#....#","#....#####"],"3823":["#..##.....","..#..#.#..","#.........","#.#.##....","#....#...#","#..#......","#...#.....","..........","..........","...#..#..#"],"3583":["#...#.###.","##......##",".#........","..#.......","....##..#.",".........#","##........","###.#...#.",".#........","#.#..####."],"2399":["#..##..#..","##......#.","#.#.#.#...","...##.#..#","......#..#","#.#.###...",".#.....#.#","###..#....",".#.#..#..#","###..##..."],"3347":[".#.#....#.","..#.#....#","..........","#.##.#.#.#","....#.....",".#....#...","#........#","#....#...#","#..####..#","..#####.#."],"1307":["#...#...#.","....#....#",".#.......#",".......#..","#.#.#...##","#..#.#.#.#","##.#.#.##.","....##....","#.....#.##",".#..#...#."],"2099":[".##...####","...#.##.##",".....##...","#...#.#...",".#......#.","#........#","...#..####","....##..#.",".....#....","..#.###..."],"3109":["#..#.###.#","....#.#.##","....##..##","#.#...#...","#.......#.","#..#......",".#.....#.#","#.##....#.","..#.......","....##..#."],"1787":["#...#...##","#.........","###.......","...#..##..","#.#.##....","##....#..#","##........","#..##.##.#","..#....###","....#..#.#"],"3019":["#.##...#.#","#...##...#","...#..#.#.","......##.#",".#..####..","#.#.....#.","#......#..","#.........","..........","...###...#"],"2857":[".#...##.#.","#.....#..#","#.....##..","#......#.#","...#..#...","...#.....#","#...###..#",".....##..#","...#...#..","##.#....##"],"3083":["#..##..##.",".#....#.##","#..#....##","..........","#...#..#.#",".........#",".#........","##.......#","..........",".##...##.."],"1583":["#.###.....","....##.#..","..........","#.....#.##","#........#","##........","#......#..",".........#","#.#.#.....",".#.####..."],"2693":["...####.#.",".........#","#.........","....#.##.#","#.......#.",".........#","...#......",".......#.#","..#.#....#",".#..#..#.."],"1019":[".#.#......","#......#.#",".#...#.#.#","#.#.......","......#.#.","#........#","##..#..#.#","#.#####.#.",".....#...#",".......###"],"1031":["#..#......",".........#","#.....#..#","....#.#.#.","..#......#","#...#....#","...#..##..",".#..#...#.",".......##.",".#.#..#..."],"3119":["...#.#..##","#.##......","....#.#.##","##..#.#..#","........#.","#...#.#...","...#.....#","..##....##","#..#...#.#","###...#.#."],"1811":[".####..###","#......#.#","#.........",".......#..","..#.##...#","........##","#....#....","#..#.#.#.#","#..#...#..","..####.###"],"2473":[".#....####","##.....#..","....#..###","#..#....#.","###...##..","..........","...#.#...#","........##","##......##","....#....."],"1373":["..#..#....","#...####.#","....#....#","....###...","...#.##.#.","#..#.#...#","...#..#..#","#..#.#...#","##.###....",".#.#####.."],"3803":["#...##.#.#","#.#..#..#.",".........#","..#......#",".#.#..#..#","..........","##..#.###.","..#####.##","....##...#",".#.##.##.."],"1291":["#..#.....#","#..#..##.#","#.#......#","....#...#.","##.######.","#........#","#....#....","#.....#...","#####.....","#######.#."],"1489":["#...#...##","#..#....#.","....##....","....#.....","#........#","#.#......#","##......##","#.#.#.....",".....#.#.#","#.#.###.##"],"2633":[".#..##.#..","..#.#...##","#.........","#..#......","#..#.....#","#.........","#....#..##","#.###.....","#.##.#..#.","...#..###."],"2441":["#.#..###..","...#.....#","#...##...#","#.##...#..","#.....####","#..#....#.","...#......","#.........","#.#.......","....###.#."],"2689":["##..#.....",".#........","..........","#.#.......","....#...##","..........","#.....#...","#...#.....","#.....#...","####...#.."],"1559":["#..###..#.","#.......##","......#...",".##..###..","#..#..##.#","..#...##.#","#.........","#..#.#...#","##.....###",".#.....#.."],"1973":[".###......","#......#.#",".#........","...#.....#","..#....#..","....##....","..........","......#..#",".....#....","#..#.#...#"],"2113":["#.##.#.#.#","..#..##...","#...#.#...",".#.#......",".#..###..#","........#.","#........#","#.#.#..#..","..........","##.##...#."],"2903":["..#...##.#","#...#.....","#..###.###","...#.#...#","#...#...##","#..#..#..#","#........#","##.###...#","#.#..#...#",".#....#..."],"2003":[".##.#..#..","...##...##",".#.....#.#","##..##...#","...#.#.#.#",".........#","#...#.##..",".....##..#","#.#..#....","###...##.#"],"2273":["...##.#...",".##....##.","#......##.","#.......##","....##...#","......#...","..#.#.....",".#.#..##.#","#........#","..#.#..#.."],"2111":["#.#..#..##","#...##...#","..........","###.....##","##......#.","..........","#....#####","#...#.#.#.","....#..#.#","#...#.###."],"2203":[".#####.##.","#...##...#","#..#...#..","#.###...##","#....##.##","#....#..##","....#.....","...#....##","#.#...#...","#.#.#..###"],"2153":["#.###..#..","..........","...#.....#","..###..##.","...#.....#","....#....#","#...#....#","#.........","#..##...#.","###.##..#."],"2963":[".#.#.####.","#....#....",".........#","#........#","#..#.....#","#.#......#","......#.##",".....#....","#...###...",".####..##."],"3491":["...##.####","#.#.....##",".#..#..##.","#........#",".#...#...#","....#...#.","#.#......#",".........#","....#...#.","##.##..#.#"],"2087":["#.#......#","#..##..#..","#..#......","#...##...#","#......#.#","#.#...#...","......#..#","#...#....#","#....#....","##.#..#..#"],"2063":["..##...##.","....#....#","#..#...#.#","#........#","##......##","..#..##..#","......#.#.","#.#.......","..##.#....",".#######.."],"3851":[".#........","#.#.....#.",".........#","......#...",".#....#..#","...##.....","#........#","#.......#.","#.#......#","##.####..#"],"1117":["##.......#","..#......#","##.......#","##........","...####.#.","..##.##..#","...#....#.","##.#......",".........#",".#.##....#"],"3967":["...#.##...","#..#..##.#","#.....##.#","#......#.#","#.......#.","##........","#..#.#.#..","....#.#.##",".#.#..#...","###.##.##."],"2879":["###..#..##",".....#.#..","...##.....","#.###.#..#",".........#",".#.#.....#","#.#.##....","#..##....#","##.......#","#.##.#####"],"2851":["###..#.##.",".###...##.","...##.#.#.","#........#","#........#",".#.#......","##.#......","..###.....",".#...#..#.","#.####..#."],"3529":[".#.#.#####","..........","...#..#..#","...#.....#","#.#......#","#....####.",".....#...#","#.##......",".#...#...#","#.#..###.#"],"3307":["#.#..###..","....#..###","#.##....##","#..#.##.#.","#.#...##.#",".#....#...","...#.#...#","...#...#.#","##......#.","...#......"],"3739":["#.###.#...",".#.#..##.#","..#..#..##","#...##...#","#...#..#..",".........#",".....#...#","##....#...",".#......##","...#..#..#"],"2617":["##.###.#..","..#......#","..#....#..",".#....#...",".#..#.....","...#..##..","...#.....#","#.......#.","#.#..#...#","..###..#.."],"2053":[".#....#.##","#...#.....",".........#","#........#","...#..##..","###..#.###","........#.",".....#####","##....#...",".###.##..#"],"2447":[".#.....##.","......##.#","#......#..",".#......#.",".#.##.#..#","#.#....###","#.#......#","##........",".#.......#","#.#.#....#"],"1999":[".#...###..","#...#..#..","#.#.......","...#....##","#.#.......","##...###..","#......#..","...###.#..","####...##.",".....#..#."],"1009":["...#####.#","....##...#","...#.#....","#..#.#.#.#","#...##....","........##","#.....#..#",".#..##.#.#","#..#...#..","...#.#..##"],"2267":[".#.#..##..",".#.......#","#........#",".#.......#","#..#...#.#","#..#..#..#",".####.....","..#......#","##.....#..","##...####."],"2131":["###.#..##.",".#....#...","...##.####","..#.#..#..","#.#....#.#","...###.#..","#.....#..#","..#...####","##.#..#..#","#..###..##"],"2251":["###.......","....#.#..#",".....#....","...#..#...",".........#","##..#.....","##.......#",".#.....#.#","#.#.....#.","#...#....."],"1109":["..##....#.",".#...#..##","#.........","#..##....#","...#...#..","#.##......",".#...#.#..","...#..##..",".#...##...",".##.###.#."],"3343":["..###.#.##","#....#.###","....#....#",".........#","..##....#.","#.....##..","#..#......",".........#",".###...#..",".#..######"],"2383":[".#.####.##","#.....#..#","#......#.#","##.....##.","#......###","....#...#.","....#...#.","##....#..#","##..###..#",".####.#..."],"2281":["..#...##..","#..#...#.#",".#........",".#.#....##","..##.#.#..","..#...#...","###.#..#.#","#...##.#.#","...##.#..#","#..#.....#"],"3191":[".###.###.#","..#.......",".##....###","...#..#...","..#......#","#...#.....","#........#","#....#..##","#.#.#...#.","#.......#."]}
# tileDict = {"2311":["..##.#..#.","##..#.....","#...##..#.","####.#...#","##.##.###.","##...#.###",".#.#.#..##","..#....#..","###...#.#.","..###..###"],"1951":["#.##...##.","#.####...#",".....#..##","#...######",".##.#....#",".###.#####","###.##.##.",".###....#.","..#.#..#.#","#...##.#.."],"1171":["####...##.","#..##.#..#","##.#..#.#.",".###.####.","..###.####",".##....##.",".#...####.","#.##.####.","####..#...",".....##..."],"1427":["###.##.#..",".#..#.##..",".#.##.#..#","#.#.#.##.#","....#...##","...##..##.","...#.#####",".#.####.#.","..#..###.#","..##.#..#."],"1489":["##.#.#....","..##...#..",".##..##...","..#...#...","#####...#.","#..#.#.#.#","...#.#.#..","##.#...##.","..##.##.##","###.##.#.."],"2473":["#....####.","#..#.##...","#.##..#...","######.#.#",".#...#.#.#",".#########",".###.#..#.","########.#","##...##.#.","..###.#.#."],"2971":["..#.#....#","#...###...","#.#.###...","##.##..#..",".#####..##",".#..####.#","#..#.#..#.","..####.###","..#.#.###.","...#.#.#.#"],"2729":["...#.#.#.#","####.#....","..#.#.....","....#..#.#",".##..##.#.",".#.####...","####.#.#..","##.####...","##..#.##..","#.##...##."],"3079":["#.#.#####.",".#..######","..#.......","######....","####.#..#.",".#...#.##.","#.#####.##","..#.###...","..#.......","..#.###..."]}

puzzleDict = {}
for tile in tileDict:
	puzzleDict[tile] = {"Up":None, "Down":None, "Left":None, "Right":None}

def getEdge(tileId, edgeName):
	tile = tileDict[tileId]
	if edgeName in ["Up", "Down"]:
		return tile[0] if edgeName == "Up" else tile[-1]
	index = 0 if edgeName == "Left" else -1
	return "".join([line[index] for line in tile])


def findMatch(tileId0, tileId1):
	edgeNames = ["Up","Down","Left","Right"]
	matches = []
	for (edgeName0, edgeName1) in itertools.product(edgeNames, repeat=2):
		edge0 = getEdge(tileId0, edgeName0)
		edge1 = getEdge(tileId1, edgeName1)

		if edgeName0 in ["Up", "Right"] and edgeName1 in ["Up", "Right"]:
			edge1 = edge1[::-1]
		elif edgeName0 in ["Down", "Left"] and edgeName1 in ["Down", "Left"]:
			edge1 = edge1[::-1]
		if edge0 == edge1:
			matches.append((edgeName0, edgeName1))
		if edge0 == edge1[::-1]:
			matches.append((edgeName0, edgeName1))
	return None if matches == [] else matches


print("Part 1:")
for tileId0, tileId1 in itertools.combinations(tileDict, 2):
	match = findMatch(tileId0, tileId1)
	if match is not None:
		(edgeName0, edgeName1) = match[0]
		puzzleDict[tileId0][edgeName0] = tileId1
		puzzleDict[tileId1][edgeName1] = tileId0

corners = []
for tileId in puzzleDict:
	nones = 0
	for edgeName in ["Up", "Down", "Left", "Right"]:
		if puzzleDict[tileId][edgeName] is None:
			nones += 1
	if nones == 2: # We know it's a corner
		corners.append(tileId)
print(numpy.prod([int(c) for c in corners]))


print("Part 2:")
print("NOTE: If you hit an infinite loop, read the code comments. You might need to change something.")

# Orient puzzle pieces
dim = int(len(tileDict)**0.5)
puzzle = [[None for _ in range(dim)] for _ in range(dim)]

def isInPuzzle(tileId):
	for row in puzzle:
		if tileId in row:
			return True
	return False

# Rotates the given tile clockwise once
def rotateTile(tile): 
	dim = len(tile)
	tile = ["".join([tile[dim - 1 - x][y] for x in range(dim)]) for y in range(dim)]
	return tile

def flipTile(tile, horizontal):
	if horizontal:
		return [row[::-1] for row in tile]
	return tile[::-1]

# place top row of puzzle
for i in range(dim):
	tileId = None
	if i == 0:
		tileId = corners[0]
	else: # place the adjacent tile that None as a direction
		previousId = puzzle[0][i-1]
		for direction in puzzleDict[previousId]: # iterate through adjacent 
			currentTileId = puzzleDict[previousId][direction]
			if currentTileId is not None and None in puzzleDict[currentTileId].values() and currentTileId not in puzzle[0]:
				tileId = currentTileId
				break
	puzzle[0][i] = tileId
# place the rest of the rows of the puzzle
for y in range(1,dim):
	for x in range(dim):
		aboveTileId = puzzle[y-1][x]
		for direction in puzzleDict[aboveTileId]:
			currentTileId = puzzleDict[aboveTileId][direction]
			if currentTileId is not None and not isInPuzzle(currentTileId):
				puzzle[y][x] = currentTileId
				break

# Orient Puzzle Pieces
def flipAndRotateToMatchLeft(leftTile, tile):
	edge = "".join([r[-1] for r in leftTile])
	while "".join([x[0] for x in tile]) != edge and "".join([x[0] for x in tile]) != edge[::-1]:
		tile = rotateTile(tile)
		# print("hi")
	if "".join([x[0] for x in tile]) != edge:
		tile = flipTile(tile, False)
	return tile

def flipAndRotateToMatchUp(upTile, tile):
	edge = upTile[-1]
	while tile[0] != edge and tile[0] != edge[::-1]:
		tile = rotateTile(tile)
	if tile[0] != edge:
		tile = flipTile(tile, True)
	return tile

def joinTiles(puzzle):
	result = ["" for _ in range(len(puzzle)*len(puzzle[0][0]))]
	for j in range(len(puzzle)):
		rowOfTiles = puzzle[j]
		for tile in rowOfTiles:
			for i, row in enumerate(tile):
				result[j * len(tile) + i] += row
	return result

# Replace puzzle IDs with actual pieces
for j in range(len(puzzle)):
	for i in range(len(puzzle[j])):
		puzzle[j][i] = tileDict[puzzle[j][i]]


# Orient top left corner
tile = tileDict[corners[0]]
puzzleEntry = puzzleDict[corners[0]]
initialNoneDirections = [d for d in puzzleEntry if puzzleEntry[d] == None]
rotations = 0
if "Up" in initialNoneDirections:
	if "Right" in initialNoneDirections:
		rotations = 3
elif "Down" in initialNoneDirections:
	if "Right" in initialNoneDirections: 
		rotations = 2
	elif "Left" in initialNoneDirections:
		rotations = 1
for _ in range(rotations):
	tile = rotateTile(tile)

# Now here's the problem. The following code will break or succeed 
# depending on whether this tile is flipped. If running this code hits
# an infinite loop, then comment/uncomment the following section
### START ###
# tile = flipTile(tile, True)
# tile = rotateTile(tile)
# tile = rotateTile(tile)
# tile = rotateTile(tile)
### END ###

puzzle[0][0] = tile

for y in range(len(puzzle)):
	for x in range(len(puzzle[y])):
		tile = puzzle[y][x]
		if x == 0 and y == 0:
			# Already took care of this case in the above code
			continue
		if y == 0:
			# Orient top row
			tile = flipAndRotateToMatchLeft(puzzle[y][x-1], tile)
		else:
			# Orient the rest of the rows
			tile = flipAndRotateToMatchUp(puzzle[y-1][x], tile)
		puzzle[y][x] = tile
		
# Remove outer layer of each tile
puzzleNoConnectors = [[None for _ in range(len(puzzle))] for _ in range(len(puzzle))]
for j, row in enumerate(puzzle):
	for i, tile in enumerate(row):
		newTile = [x[1:-1] for index, x in enumerate(tile) if index > 0 and index < len(tile) - 1]
		puzzleNoConnectors[j][i] = newTile

image = joinTiles(puzzleNoConnectors)

def findSeaMonsters(image):
	numOfSeaMonsters = 0
	monster = ["                  # ","#    ##    ##    ###"," #  #  #  #  #  #   "]
	for y in range(2, len(image)):
		for x in range(20, len(image[y]) + 1):
			topRow = image[y-2][x-20:x]
			middleRow = image[y-1][x-20:x]
			bottomRow = image[y][x-20:x]
			isMonster = True
			for i in range(20):
				if topRow[i] != "#" and monster[0][i] == "#":
					isMonster = False
				if middleRow[i] != "#" and monster[1][i] == "#":
					isMonster = False
				if bottomRow[i] != "#" and monster[2][i] == "#":
					isMonster = False
			if isMonster:
				numOfSeaMonsters += 1
	return numOfSeaMonsters


numOfSeaMonsters = 0
while True:
	numOfSeaMonsters = findSeaMonsters(image)
	if numOfSeaMonsters > 0:
		break
	image = rotateTile(image)
	numOfSeaMonsters = findSeaMonsters(image)
	if numOfSeaMonsters > 0:
		break
	image = rotateTile(image)
	numOfSeaMonsters = findSeaMonsters(image)
	if numOfSeaMonsters > 0:
		break
	image = rotateTile(image)
	numOfSeaMonsters = findSeaMonsters(image)
	if numOfSeaMonsters > 0:
		break
	image = flipTile(image, True)
	numOfSeaMonsters = findSeaMonsters(image)
	if numOfSeaMonsters > 0:
		break
	image = rotateTile(image)
	numOfSeaMonsters = findSeaMonsters(image)
	if numOfSeaMonsters > 0:
		break
	image = rotateTile(image)
	numOfSeaMonsters = findSeaMonsters(image)
	if numOfSeaMonsters > 0:
		break
	image = rotateTile(image)
	numOfSeaMonsters = findSeaMonsters(image)
	if numOfSeaMonsters > 0:
		break

	print("NO SEA MONSTERS FOUND")
	exit()

waterRoughness = -numOfSeaMonsters*15
for r in image:
	for c in r:
		if c == "#":
			waterRoughness += 1
print(waterRoughness)


